{% load static %}
<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Nova AI | Your Intelligent Assistant</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="image/png" href="{% static 'chatbot/robot.png' %}">
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;400;500;600;700&family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
    <style>
        :root {
          --primary: #6366f1;
          --primary-dark: #4f46e5;
          --primary-light: #818cf8;
          --accent: #f472b6;
          --accent-secondary: #22d3ee;
          --dark: #0f172a;
          --dark-light: #1e293b;
          --dark-lighter: #334155;
          --gray: #64748b;
          --gray-light: #94a3b8;
          --light: #f1f5f9;
          --white: #ffffff;
          --glass: rgba(255, 255, 255, 0.05);
          --glass-border: rgba(255, 255, 255, 0.1);
          --shadow-glow: 0 0 60px rgba(99, 102, 241, 0.3);
        }

        * {
          box-sizing: border-box;
          margin: 0;
          padding: 0;
        }

        body {
          font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
          background: var(--dark);
          min-height: 100vh;
          overflow: hidden;
          position: relative;
        }

        /* Animated Background */
        .bg-animation {
          position: fixed;
          top: 0;
          left: 0;
          width: 100%;
          height: 100%;
          z-index: 0;
          overflow: hidden;
        }

        .bg-gradient {
          position: absolute;
          width: 100%;
          height: 100%;
          background: 
            radial-gradient(ellipse at 20% 20%, rgba(99, 102, 241, 0.15) 0%, transparent 50%),
            radial-gradient(ellipse at 80% 80%, rgba(244, 114, 182, 0.1) 0%, transparent 50%),
            radial-gradient(ellipse at 50% 50%, rgba(34, 211, 238, 0.05) 0%, transparent 70%);
        }

        .floating-orb {
          position: absolute;
          border-radius: 50%;
          filter: blur(60px);
          animation: float 20s infinite ease-in-out;
        }

        .orb-1 {
          width: 400px;
          height: 400px;
          background: rgba(99, 102, 241, 0.3);
          top: -100px;
          left: -100px;
          animation-delay: 0s;
        }

        .orb-2 {
          width: 300px;
          height: 300px;
          background: rgba(244, 114, 182, 0.2);
          bottom: -50px;
          right: -50px;
          animation-delay: -7s;
        }

        .orb-3 {
          width: 200px;
          height: 200px;
          background: rgba(34, 211, 238, 0.2);
          top: 50%;
          left: 50%;
          animation-delay: -14s;
        }

        @keyframes float {
          0%, 100% { transform: translate(0, 0) scale(1); }
          25% { transform: translate(50px, -50px) scale(1.1); }
          50% { transform: translate(0, 50px) scale(0.9); }
          75% { transform: translate(-50px, -25px) scale(1.05); }
        }

        /* Grid Pattern Overlay */
        .grid-pattern {
          position: absolute;
          width: 100%;
          height: 100%;
          background-image: 
            linear-gradient(rgba(255, 255, 255, 0.02) 1px, transparent 1px),
            linear-gradient(90deg, rgba(255, 255, 255, 0.02) 1px, transparent 1px);
          background-size: 50px 50px;
          mask-image: radial-gradient(ellipse at center, black 30%, transparent 70%);
        }

        /* Main Container */
        .app-wrapper {
          position: relative;
          z-index: 1;
          height: 100vh;
          display: flex;
          align-items: center;
          justify-content: center;
          padding: 20px;
        }

        .app-container {
          width: 100%;
          max-width: 900px;
          height: 90vh;
          max-height: 800px;
          display: flex;
          flex-direction: column;
          background: rgba(15, 23, 42, 0.8);
          backdrop-filter: blur(20px);
          border: 1px solid var(--glass-border);
          border-radius: 32px;
          box-shadow: 
            var(--shadow-glow),
            0 25px 50px -12px rgba(0, 0, 0, 0.5),
            inset 0 1px 0 rgba(255, 255, 255, 0.1);
          overflow: hidden;
        }

        /* Header */
        .chat-header {
          padding: 24px 32px;
          background: linear-gradient(180deg, rgba(30, 41, 59, 0.8) 0%, transparent 100%);
          border-bottom: 1px solid var(--glass-border);
          display: flex;
          align-items: center;
          justify-content: space-between;
        }

        .header-left {
          display: flex;
          align-items: center;
          gap: 16px;
        }

        .avatar-container {
          position: relative;
        }

        .chat-header-avatar {
          width: 52px;
          height: 52px;
          border-radius: 16px;
          border: 2px solid var(--primary);
          padding: 2px;
          background: var(--dark-light);
          box-shadow: 0 0 20px rgba(99, 102, 241, 0.4);
        }

        .status-indicator {
          position: absolute;
          bottom: -2px;
          right: -2px;
          width: 16px;
          height: 16px;
          background: #22c55e;
          border: 3px solid var(--dark);
          border-radius: 50%;
          animation: pulse-status 2s infinite;
        }

        @keyframes pulse-status {
          0%, 100% { box-shadow: 0 0 0 0 rgba(34, 197, 94, 0.4); }
          50% { box-shadow: 0 0 0 8px rgba(34, 197, 94, 0); }
        }

        .chat-header-info h2 {
          font-family: 'Space Grotesk', sans-serif;
          font-size: 22px;
          font-weight: 600;
          color: var(--white);
          letter-spacing: -0.5px;
          display: flex;
          align-items: center;
          gap: 8px;
        }

        .ai-badge {
          font-size: 10px;
          font-weight: 600;
          padding: 4px 8px;
          background: linear-gradient(135deg, var(--primary), var(--accent));
          border-radius: 20px;
          letter-spacing: 0.5px;
        }

        .chat-header-info p {
          font-size: 13px;
          color: var(--gray-light);
          margin-top: 4px;
        }

        .header-actions {
          display: flex;
          gap: 8px;
        }

        .header-btn {
          width: 40px;
          height: 40px;
          border: none;
          background: var(--glass);
          border: 1px solid var(--glass-border);
          border-radius: 12px;
          color: var(--gray-light);
          cursor: pointer;
          transition: all 0.3s ease;
          display: flex;
          align-items: center;
          justify-content: center;
        }

        .header-btn:hover {
          background: var(--dark-lighter);
          color: var(--white);
          transform: translateY(-2px);
        }

        /* Messages Container */
        .chat-messages-container {
          flex: 1;
          overflow-y: auto;
          padding: 32px;
          scroll-behavior: smooth;
        }

        .chat-messages-container::-webkit-scrollbar {
          width: 6px;
        }

        .chat-messages-container::-webkit-scrollbar-track {
          background: transparent;
        }

        .chat-messages-container::-webkit-scrollbar-thumb {
          background: var(--dark-lighter);
          border-radius: 10px;
        }

        .chat-messages-container::-webkit-scrollbar-thumb:hover {
          background: var(--gray);
        }

        /* Welcome State */
        .welcome-container {
          display: flex;
          flex-direction: column;
          align-items: center;
          justify-content: center;
          height: 100%;
          text-align: center;
          padding: 40px;
        }

        .welcome-icon {
          width: 120px;
          height: 120px;
          background: linear-gradient(135deg, var(--primary), var(--accent));
          border-radius: 32px;
          display: flex;
          align-items: center;
          justify-content: center;
          margin-bottom: 32px;
          box-shadow: 
            0 20px 40px rgba(99, 102, 241, 0.3),
            inset 0 1px 0 rgba(255, 255, 255, 0.2);
          animation: welcome-float 3s ease-in-out infinite;
        }

        @keyframes welcome-float {
          0%, 100% { transform: translateY(0); }
          50% { transform: translateY(-10px); }
        }

        .welcome-icon svg {
          width: 60px;
          height: 60px;
          color: white;
        }

        .welcome-title {
          font-family: 'Space Grotesk', sans-serif;
          font-size: 32px;
          font-weight: 700;
          color: var(--white);
          margin-bottom: 12px;
          letter-spacing: -1px;
        }

        .welcome-subtitle {
          font-size: 16px;
          color: var(--gray-light);
          max-width: 400px;
          line-height: 1.6;
          margin-bottom: 40px;
        }

        .suggestion-chips {
          display: flex;
          flex-wrap: wrap;
          gap: 12px;
          justify-content: center;
        }

        .suggestion-chip {
          padding: 12px 20px;
          background: var(--glass);
          border: 1px solid var(--glass-border);
          border-radius: 100px;
          color: var(--gray-light);
          font-size: 14px;
          cursor: pointer;
          transition: all 0.3s ease;
        }

        .suggestion-chip:hover {
          background: var(--primary);
          border-color: var(--primary);
          color: var(--white);
          transform: translateY(-2px);
          box-shadow: 0 10px 20px rgba(99, 102, 241, 0.3);
        }

        /* Messages */
        .message-wrapper {
          margin-bottom: 24px;
          animation: message-slide 0.4s cubic-bezier(0.16, 1, 0.3, 1);
        }

        @keyframes message-slide {
          from {
            opacity: 0;
            transform: translateY(20px);
          }
          to {
            opacity: 1;
            transform: translateY(0);
          }
        }

        .chat-message-user,
        .chat-message-robot {
          display: flex;
          gap: 16px;
          align-items: flex-start;
        }

        .chat-message-user {
          flex-direction: row-reverse;
        }

        .message-avatar {
          flex-shrink: 0;
        }

        .chat-message-profile {
          width: 40px;
          height: 40px;
          border-radius: 12px;
          display: flex;
          align-items: center;
          justify-content: center;
          color: white;
        }

        .robot-avatar {
          background: linear-gradient(135deg, var(--primary), var(--primary-dark));
        }

        .user-avatar {
          background: linear-gradient(135deg, var(--accent), #ec4899);
        }

        .message-content {
          max-width: 70%;
        }

        .chat-message-text {
          padding: 16px 20px;
          font-size: 15px;
          line-height: 1.7;
          word-wrap: break-word;
        }

        .chat-message-robot .chat-message-text {
          background: var(--dark-light);
          color: var(--light);
          border-radius: 4px 20px 20px 20px;
          border: 1px solid var(--glass-border);
        }

        .chat-message-user .chat-message-text {
          background: linear-gradient(135deg, var(--primary), var(--primary-dark));
          color: var(--white);
          border-radius: 20px 4px 20px 20px;
          box-shadow: 0 10px 30px rgba(99, 102, 241, 0.3);
        }

        .message-time {
          font-size: 11px;
          color: var(--gray);
          margin-top: 8px;
          padding: 0 4px;
        }

        .chat-message-user .message-time {
          text-align: right;
        }

        /* Typing Indicator */
        .typing-indicator {
          display: flex;
          gap: 6px;
          align-items: center;
          padding: 8px 4px;
        }

        .typing-dot {
          width: 8px;
          height: 8px;
          background: var(--primary-light);
          border-radius: 50%;
          animation: typing-bounce 1.4s infinite ease-in-out;
        }

        .typing-dot:nth-child(1) { animation-delay: 0s; }
        .typing-dot:nth-child(2) { animation-delay: 0.2s; }
        .typing-dot:nth-child(3) { animation-delay: 0.4s; }

        @keyframes typing-bounce {
          0%, 60%, 100% {
            transform: translateY(0);
            opacity: 0.4;
          }
          30% {
            transform: translateY(-8px);
            opacity: 1;
          }
        }

        /* Input Area */
        .chat-input-wrapper {
          padding: 24px 32px;
          background: linear-gradient(180deg, transparent 0%, rgba(30, 41, 59, 0.5) 100%);
          border-top: 1px solid var(--glass-border);
        }

        .chat-input-container {
          display: flex;
          gap: 16px;
          align-items: flex-end;
          background: var(--dark-light);
          border: 1px solid var(--glass-border);
          border-radius: 24px;
          padding: 8px;
          transition: all 0.3s ease;
        }

        .chat-input-container:focus-within {
          border-color: var(--primary);
          box-shadow: 0 0 0 4px rgba(99, 102, 241, 0.15);
        }

        .chat-input {
          flex: 1;
          background: transparent;
          border: none;
          padding: 12px 16px;
          font-size: 15px;
          font-family: inherit;
          color: var(--white);
          outline: none;
          resize: none;
          min-height: 24px;
          max-height: 120px;
        }

        .chat-input::placeholder {
          color: var(--gray);
        }

        .input-actions {
          display: flex;
          gap: 8px;
          padding-right: 4px;
        }

        .action-btn {
          width: 44px;
          height: 44px;
          border: none;
          background: transparent;
          color: var(--gray);
          border-radius: 12px;
          cursor: pointer;
          transition: all 0.3s ease;
          display: flex;
          align-items: center;
          justify-content: center;
        }

        .action-btn:hover {
          color: var(--white);
          background: var(--dark-lighter);
        }

        .send-button {
          width: 44px;
          height: 44px;
          border: none;
          background: linear-gradient(135deg, var(--primary), var(--primary-dark));
          color: var(--white);
          border-radius: 12px;
          cursor: pointer;
          transition: all 0.3s ease;
          display: flex;
          align-items: center;
          justify-content: center;
          box-shadow: 0 4px 15px rgba(99, 102, 241, 0.4);
        }

        .send-button:hover:not(:disabled) {
          transform: scale(1.05);
          box-shadow: 0 6px 20px rgba(99, 102, 241, 0.5);
        }

        .send-button:active:not(:disabled) {
          transform: scale(0.95);
        }

        .send-button:disabled {
          background: var(--dark-lighter);
          box-shadow: none;
          cursor: not-allowed;
          opacity: 0.5;
        }

        .send-button svg {
          transition: transform 0.3s ease;
        }

        .send-button:hover:not(:disabled) svg {
          transform: translateX(2px);
        }

        /* Quick Tips */
        .quick-tips {
          display: flex;
          gap: 8px;
          margin-top: 12px;
          padding: 0 8px;
          overflow-x: auto;
          scrollbar-width: none;
        }

        .quick-tips::-webkit-scrollbar {
          display: none;
        }

        .quick-tip {
          flex-shrink: 0;
          padding: 6px 12px;
          background: var(--glass);
          border: 1px solid var(--glass-border);
          border-radius: 8px;
          font-size: 12px;
          color: var(--gray-light);
          cursor: pointer;
          transition: all 0.2s ease;
          white-space: nowrap;
        }

        .quick-tip:hover {
          background: var(--dark-lighter);
          color: var(--white);
        }

        /* Responsive */
        @media (max-width: 768px) {
          .app-wrapper {
            padding: 0;
          }

          .app-container {
            border-radius: 0;
            height: 100vh;
            max-height: none;
          }

          .chat-header {
            padding: 16px 20px;
          }

          .chat-messages-container {
            padding: 20px;
          }

          .chat-input-wrapper {
            padding: 16px 20px;
          }

          .message-content {
            max-width: 85%;
          }

          .welcome-title {
            font-size: 24px;
          }

          .suggestion-chips {
            flex-direction: column;
          }
        }

        /* Custom Animation for New Messages */
        .new-message {
          animation: glow-in 0.6s ease-out;
        }

        @keyframes glow-in {
          0% {
            opacity: 0;
            transform: translateY(20px) scale(0.9);
            filter: blur(10px);
          }
          100% {
            opacity: 1;
            transform: translateY(0) scale(1);
            filter: blur(0);
          }
        }
    </style>
  </head>
  <body>
    <!-- Animated Background -->
    <div class="bg-animation">
      <div class="bg-gradient"></div>
      <div class="floating-orb orb-1"></div>
      <div class="floating-orb orb-2"></div>
      <div class="floating-orb orb-3"></div>
      <div class="grid-pattern"></div>
    </div>

    <div class="js-container"></div>

    <script src="https://unpkg.com/react@18.3.1/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18.3.1/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/supersimpledev/dayjs.js"></script>
    <script src="https://unpkg.com/supersimpledev/chatbot.js"></script>
    <script type="text/babel">

        const container = document.querySelector('.js-container');

        // Icons as components

        const SendIcon = () => (
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <path d="m22 2-7 20-4-9-9-4Z"/><path d="M22 2 11 13"/>
            </svg>
        );

        const BotIcon = () => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <path d="M12 8V4H8"/><rect width="16" height="12" x="4" y="8" rx="2"/>
                <path d="M2 14h2"/><path d="M20 14h2"/><path d="M15 13v2"/><path d="M9 13v2"/>
            </svg>
        );

        const UserIcon = () => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <circle cx="12" cy="8" r="5"/><path d="M20 21a8 8 0 0 0-16 0"/>
            </svg>
        );

        const SettingsIcon = () => (
            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"/>
                <circle cx="12" cy="12" r="3"/>
            </svg>
        );

        const MoreIcon = () => (
            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <circle cx="12" cy="12" r="1"/><circle cx="19" cy="12" r="1"/><circle cx="5" cy="12" r="1"/>
            </svg>
        );
        
        function ChatHeader() {
            return (
                <div className="chat-header">
                    <div className="header-left">
                        <div className="avatar-container">
                            <img src="{% static 'chatbot/robot.png' %}" alt="Nova AI" className="chat-header-avatar" />
                            <div className="status-indicator"></div>
                        </div>
                        <div className="chat-header-info">
                            <h2>Nova <span className="ai-badge">AI</span></h2>
                            <p>Online â€¢ Ready to assist</p>
                        </div>
                    </div>
                    <div className="header-actions">
                        <button className="header-btn" title="Settings">
                            <SettingsIcon />
                        </button>
                        <button className="header-btn" title="More options">
                            <MoreIcon />
                        </button>
                    </div>
                </div>
            );
        }

        function WelcomeScreen({ onSuggestionClick }) {
            const suggestions = [
                "ðŸ’¡ Hey!",
                "âœ¨ Tell Todays date",
                "ðŸ”§ Roll a dice",
                "ðŸ“Š Flip a coin"
            ];

            return (
                <div className="welcome-container">
                    <h1 className="welcome-title">How can I help you today?</h1>
                    <p className="welcome-subtitle">
                        I'm Nova, your AI assistant. Ask me anything â€“ from coding help to creative writing, I'm here to assist.
                    </p>
                    <div className="suggestion-chips">
                        {suggestions.map((suggestion, index) => (
                            <button 
                                key={index} 
                                className="suggestion-chip"
                                onClick={() => onSuggestionClick(suggestion.replace(/^[^\s]+\s/, ''))}
                            >
                                {suggestion}
                            </button>
                        ))}
                    </div>
                </div>
            );
        }

        function ChatInput({chatMessages, setChatMessages, isLoading, setIsLoading, onSuggestionClick}) {
            const [inputText, setInputText] = React.useState('');
            const inputRef = React.useRef(null);
            const isFirstRender = React.useRef(true);

            React.useEffect(() => {
                if (!isLoading && !isFirstRender.current) {
                    inputRef.current?.focus();
                }
                isFirstRender.current = false;
            }, [isLoading]);

            // Expose sendMessage via callback
            React.useEffect(() => {
                if (onSuggestionClick) {
                    onSuggestionClick.current = (text) => {
                        setInputText(text);
                        setTimeout(() => {
                            if (text.trim()) {
                                sendMessageWithText(text);
                            }
                        }, 100);
                    };
                }
            }, [chatMessages]);

            function handleKeyDown(event) {
                if (event.key === 'Enter' && !event.shiftKey && inputText.trim() !== '') {
                    event.preventDefault();
                    sendMessage();
                }
                if (event.key === 'Escape') {
                    setInputText('');
                }
            }

            function saveInputText(event) {
                setInputText(event.target.value);
            }

            async function sendMessageWithText(text) {
                if (text.trim() === '') return;
                
                setIsLoading(true);
                setInputText('');
                
                const newMessage = [...chatMessages, {
                    message: text,
                    sender: 'user',
                    key: Math.random(),
                    time: new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })
                }];
                setChatMessages(newMessage);

                const response = await Chatbot.getResponseAsync(text);
                setChatMessages([...newMessage, {
                    message: response,
                    sender: 'robot',
                    key: Math.random(),
                    time: new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })
                }]);

                setIsLoading(false);
            }
            
            async function sendMessage() {
                await sendMessageWithText(inputText);
            }
        
            return (
                <div className="chat-input-wrapper">
                    <div className="chat-input-container">
                        <input 
                            ref={inputRef}
                            type="text" 
                            placeholder="Message Nova..." 
                            className="chat-input"
                            onChange={saveInputText} 
                            value={inputText}
                            onKeyDown={handleKeyDown}
                            disabled={isLoading}
                        />
                        <div className="input-actions">
                            <button 
                                onClick={sendMessage} 
                                disabled={isLoading || inputText.trim() === ''} 
                                className="send-button"
                                title="Send message"
                            >
                                <SendIcon />
                            </button>
                        </div>
                    </div>
                    <div className="quick-tips">
                        <span className="quick-tip" onClick={() => setInputText("What can you help me with?")}>What can you do?</span>
                        <span className="quick-tip" onClick={() => setInputText("Roll a dice")}>Roll a dice</span>
                        <span className="quick-tip" onClick={() => setInputText("Flip a coin")}>Flip a coin</span>
                        <span className="quick-tip" onClick={() => setInputText("What is the date today")}>What is the date today</span>
                    </div>
                </div>
            );
        }
        
        function ChatMessage({message, sender, time, isLoading}) {
            return(
                <div className="message-wrapper">
                    <div className={sender === 'user' ? "chat-message-user" : "chat-message-robot"}>
                        <div className="message-avatar">
                            {sender === 'robot' ? (
                                <div className="chat-message-profile robot-avatar">
                                    <BotIcon />
                                </div>
                            ) : (
                                <div className="chat-message-profile user-avatar">
                                    <UserIcon />
                                </div>
                            )}
                        </div>
                        <div className="message-content">
                            <div className="chat-message-text">
                                {isLoading ? (
                                    <div className="typing-indicator">
                                        <span className="typing-dot"></span>
                                        <span className="typing-dot"></span>
                                        <span className="typing-dot"></span>
                                    </div>
                                ) : message}
                            </div>
                            {!isLoading && <div className="message-time">{time}</div>}
                        </div>
                    </div>
                </div>
            );
        }

        function ChatMessages({chatMessages, isLoading, onSuggestionClick}) {
            const chatMessagesRef = React.useRef(null);

            React.useEffect(() => {
                const containerElem = chatMessagesRef.current;
                if (containerElem) {
                    containerElem.scrollTop = containerElem.scrollHeight;
                }
            }, [chatMessages, isLoading]);

            const handleSuggestion = (text) => {
                if (onSuggestionClick?.current) {
                    onSuggestionClick.current(text);
                }
            };
            
            return (
                <div className="chat-messages-container" ref={chatMessagesRef}>
                    {chatMessages.length === 0 && !isLoading ? (
                        <WelcomeScreen onSuggestionClick={handleSuggestion} />
                    ) : (
                        <>
                            {chatMessages.map((chatMessage) => (
                                <ChatMessage 
                                    key={chatMessage.key} 
                                    message={chatMessage.message} 
                                    sender={chatMessage.sender}
                                    time={chatMessage.time}
                                    isLoading={false} 
                                />
                            ))}
                            {isLoading && (
                                <ChatMessage 
                                    message=""
                                    sender="robot"
                                    time=""
                                    isLoading={true} 
                                />
                            )}
                        </>
                    )}
                </div>
            );
        }

        function App() {
            const [chatMessages, setChatMessages] = React.useState([]);
            const [isLoading, setIsLoading] = React.useState(false);
            const suggestionCallback = React.useRef(null);
            
            return (
                <div className="app-wrapper">
                    <div className="app-container">
                        <ChatHeader />
                        <ChatMessages 
                            chatMessages={chatMessages} 
                            isLoading={isLoading} 
                            onSuggestionClick={suggestionCallback}
                        />
                        <ChatInput 
                            chatMessages={chatMessages} 
                            setChatMessages={setChatMessages} 
                            isLoading={isLoading} 
                            setIsLoading={setIsLoading}
                            onSuggestionClick={suggestionCallback}
                        />
                    </div>
                </div>
            );
        }

        ReactDOM.createRoot(container).render(<App />);

    </script>
  </body>
</html>
